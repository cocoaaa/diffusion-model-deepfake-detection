# Plot spectra of images generated by models in gm256

exp_id=20230320-141018
imgdir_root=/data/datasets/neurips23_gm256/

<!-- //img_dirs="model_dir1.name model_dir2.name ..."  -->
<!-- img_dirs=($imgdir_root/*/)  #check: declare -p img_dirs ; src: https://stackoverflow.com/a/72262551 -->
img_dirs="real-celebahq256 gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan score-ddpm score-ldm score-lsgm score-ncsnpp score-rve vae-alae vae-effvdvae vae-nvae vae-vaebm"

transform=fft_hp

workdir=.
outdir=$workdir/outs/freq/$transform/$exp_id
<!-- out_fn=avg-dft-spectra-gm256 -->

num_samples_per_imgdir=1000 # 10_000 value used in ricker22
ks=3

export QT_QPA_PLATFORM=offscreen  # if qt error happens and core dump kills the process

python frequency_analysis.py  $imgdir_root   $outdir   $transform  \
--img-dirs  $img_dirs  --num_samples_per_imgdir $num_samples_per_imgdir \
--log \
--experiment $exp_id \
--num-workers 1 
\

<!-- --img-dirs gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan score-ddpm score-ldm score-lsgm score-ncsnpp vae-effvdvae vae-nvae vae-vaebm \ -->


## run2:
exp_id=20230320-170631
imgdir_root=/data/datasets/neurips23_gm256/

img_dirs="real-celebahq256 gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan score-ddpm score-ldm score-lsgm score-ncsnpp score-rve vae-alae vae-effvdvae vae-nvae vae-vaebm"

transform=fft_hp

workdir=.
outdir=$workdir/outs/freq/$transform/$exp_id

num_samples_per_imgdir=10000 # 10_000 value used in ricker22
<!-- ks=3 -->

export QT_QPA_PLATFORM=offscreen  # if qt error happens and core dump kills the process

python frequency_analysis.py  $imgdir_root   $outdir   $transform  \
--img-dirs  $img_dirs  --num_samples_per_imgdir $num_samples_per_imgdir \
--log \
--experiment $exp_id \
--num-workers 1  \
--overwrite \
\

# todo: #here
1. set vmin, vmax, rerun
python frequency_analysis.py $WORKDIR/data/diffusion_model_deepfakes_lsun_bedroom/test $WORKDIR/output fft_hp --img-dirs Real ProGAN StyleGAN ProjectedGAN Diff-StyleGAN2 Diff-ProjectedGAN --log --vmin 1e-5 --vmax 1e-1
python frequency_analysis.py $WORKDIR/data/diffusion_model_deepfakes_lsun_bedroom/test $WORKDIR/output fft_hp --img-dirs Real DDPM IDDPM ADM PNDM LDM --log --vmin 1e-5 --vmax 1e-1

2. outfn - needs to be unique at each run

## run2 
- with log, vmin, vmax as in readmr
- nsample=1
- suffix: 20230321=020904
- 
## run3:
exp_id=x
imgdir_root=/data/datasets/neurips23_gm256/

img_dirs="real-celebahq256 gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan score-ddpm score-ldm score-lsgm score-ncsnpp score-rve vae-alae vae-effvdvae vae-nvae vae-vaebm"

transform=fft_hp

workdir=.
outdir=$workdir/outs/freq/$transform/$exp_id

num_samples_per_imgdir=10000 # 10_000 value used in ricker22
<!-- ks=3 -->

export QT_QPA_PLATFORM=offscreen  # if qt error happens and core dump kills the process

nohup \ 
python frequency_analysis.py  $imgdir_root   $outdir   $transform  \
--img-dirs  $img_dirs  --num_samples_per_imgdir $num_samples_per_imgdir \
--log --vmin 1e-5 --vmax 1e-1 \
--experiment $exp_id \
--num-workers 1  \
--overwrite \
&
20230321-021052
pid: 7572



## run4: Run ricker22's plot_spectra on our GM256 dataset --#here
Let's just see what spectra plots come out if we run ricker22's visualization
of spectra with his settings for `vmin`, `vmax`, and plot in logscale.

He plot the spectra of various GMs in two commands separately, so that he can generate
nice figures for his paper.
I'm going to do similarly. I have 14 total GM's. we generate one row of spectra per model fam:

- output plots are located: 
  - `/data/hayley-old/Github/Fingerprints/diffusion-model-deepfake-detection/outs/freq/frequency_analysis/plots`
    - for gans: `/data/hayley-old/Github/Fingerprints/diffusion-model-deepfake-detection/outs/freq/frequency_analysis/plots/fft_hp-mean-fft-hp_gans-20230321-204609-gan-ddgan_gan-stylegan2_gan-styleswin_gan-vqgan.pdf`
    - for vaes: `/data/hayley-old/Github/Fingerprints/diffusion-model-deepfake-detection/outs/freq/frequency_analysis/plots/fft_hp-mean-fft-hp_real-20230321-204609-vae-alae_vae-effvdvae_vae-nvae_vae-vaebm.pdf`
    - for scores: `/data/hayley-old/Github/Fingerprints/diffusion-model-deepfake-detection/outs/freq/frequency_analysis/plots/fft_hp-mean-fft-hp_scores-20230321-204609-score-ddpm_score-ldm_score-lsgm_score-ncsnpp_score-rve.pdf`
    - for real: `/data/hayley-old/Github/Fingerprints/diffusion-model-deepfake-detection/outs/freq/frequency_analysis/plots/fft_hp-mean-fft-hp_real-20230321-204609-real-celebahq256.pdf`

### Plot avg. spectra of high-passed images for gan's
now2str=20230321-204609

```shell
exp_id=fft-hp_gans-$now2str
img_root_dir=/data/datasets/neurips23_gm256
gan_img_dirs="gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $gan_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1 \
2>&1 &

```
- started: 20230321-211711
- pid: 26371


### Plot avg. spectra of high-passed iamges for vae's 
```shell
exp_id=fft-hp_vaes-$now2str
img_root_dir=/data/datasets/neurips23_gm256
vae_img_dirs="vae-alae vae-effvdvae vae-nvae vae-vaebm"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $vae_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1 \
> log-$exp_id.txt 2>&1 &
```

- started: 20230321-212131
- pid: 32116 

### Plot avg. spectra of high-passed iamges for scores's 
```shell
exp_id=fft-hp_scores-$now2str
img_root_dir=/data/datasets/neurips23_gm256
score_img_dirs="score-ddpm score-ldm score-lsgm score-ncsnpp score-rve"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $score_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1  \
> log-$exp_id.txt 2>&1 &
```
- started: 20230321-212851
- pid:  11224
- status: running


### Plot avg. spectra of high-passed iamges for real 
```shell
exp_id=fft-hp_real-$now2str
img_root_dir=/data/datasets/neurips23_gm256
real_img_dirs="real-celebahq256"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \ 
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $real_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1 \
> log-$exp_id.txt 2>&1 &
```
- started:  20230321-212246
- pid:  2263
- status: done!



## run5: Plot the different of fft_hp of gm vs. real for each gm

- output plots are located: 
  - `/data/hayley-old/Github/Fingerprints/diffusion-model-deepfake-detection/outs/freq/frequency_analysis/plots`

### Plot avg. spectra of high-passed images for gan's
now2str=20230322-172405

```shell
exp_id=fft-hp_gans-$now2str
img_root_dir=/data/datasets/neurips23_gm256
gan_img_dirs="gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $gan_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1 \
2>&1 &

```
- started: 20230321-211711
- pid: 26371


### Plot avg. spectra of high-passed iamges for vae's 
```shell
exp_id=fft-hp_vaes-$now2str
img_root_dir=/data/datasets/neurips23_gm256
vae_img_dirs="vae-alae vae-effvdvae vae-nvae vae-vaebm"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $vae_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1 \
> log-$exp_id.txt 2>&1 &
```

- started: 20230321-212131
- pid: 32116 

### Plot avg. spectra of high-passed iamges for scores's 
```shell
exp_id=fft-hp_scores-$now2str
img_root_dir=/data/datasets/neurips23_gm256
score_img_dirs="score-ddpm score-ldm score-lsgm score-ncsnpp score-rve"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $score_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1  \
> log-$exp_id.txt 2>&1 &
```
- started: 20230321-212851
- pid:  11224
- status: running


### Plot avg. spectra of high-passed iamges for real 
```shell
exp_id=fft-hp_real-$now2str
img_root_dir=/data/datasets/neurips23_gm256
real_img_dirs="real-celebahq256"
out_dir_root="./outs/freq"
transform='fft_hp' # or 'fft' or 'dct'
vmin=1e-5
vmax=1e-1
n_samples=5000

nohup \ 
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $real_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log --vmin $vmin --vmax $vmax \
--experiment $exp_id \
--num_workers 1 \
> log-$exp_id.txt 2>&1 &
```
- started:  20230321-212246
- pid:  2263
- status: done!



## spectral density / 1dim - viz

```bash
python frequency_analysis.py $WORKDIR/data/diffusion_model_deepfakes_lsun_bedroom/test $WORKDIR/output density --img-dirs Real ProGAN StyleGAN ProjectedGAN Diff-StyleGAN2 Diff-ProjectedGAN --log --fraction 0.49 --zoom
python frequency_analysis.py $WORKDIR/data/diffusion_model_deepfakes_lsun_bedroom/test $WORKDIR/output density --img-dirs Real DDPM IDDPM ADM PNDM LDM --log --fraction 0.49 --zoom
```
### Plot for gan's


```shell
export QT_QPA_PLATFORM=offscreen

now2str=20230327-010008
exp_id=spectral-density-$now2str
img_root_dir=/data/datasets/neurips23_gm256
gan_img_dirs="real-celebahq256 gan-ddgan gan-stylegan2 gan-styleswin gan-vqgan"
out_dir_root="./outs/spectral-density"
transform='density' # or 'fft' or 'dct'
n_samples=1000 #50000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $gan_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log \
--experiment $exp_id \
--num_workers 1 \
--overwrite & 



```
- started: 20230327-011718
- pid:1649 


#### diff
```shell
nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $gan_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log \
--experiment $exp_id \
--num_workers 1  --diff \
--overwrite & 
```
- started: 20230327-011718
- pid: 2092


### Plot avg. spectra of high-passed iamges for vae's 
```shell
export QT_QPA_PLATFORM=offscreen

now2str=20230327-010008
exp_id=spectral-density-$now2str
img_root_dir=/data/datasets/neurips23_gm256
vae_img_dirs="real-celebahq256 vae-alae vae-effvdvae vae-nvae vae-vaebm"
out_dir_root="./outs/spectral-density"
transform='density' # or 'fft' or 'dct'
n_samples=1000 #50000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $vae_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log  \
--experiment $exp_id \
--num_workers 1 \
--overwrite  &
```

- started: 20230327-013550
- pid: 2219 

#### diff plot
```shell
nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $vae_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log  \
--experiment $exp_id \
--num_workers 1 --diff \
--overwrite & 
```

- started: 20230327-013615 
- pid: 32507 -- exited; why??
- 



### Plot avg. spectra of high-passed iamges for scores's 
```shell
export QT_QPA_PLATFORM=offscreen

now2str=20230327-010008
exp_id=spectral-density-$now2str
img_root_dir=/data/datasets/neurips23_gm256
score_img_dirs="real-celebahq256 score-ddpm score-ldm score-lsgm score-ncsnpp score-rve"
out_dir_root="./outs/spectral-density"
transform='density' # or 'fft' or 'dct'
n_samples=1000

nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $score_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log  \
--experiment $exp_id \
--num_workers 1 \
--overwrite  &
```


- started: 20230327-013815
- pid: 2821 
- status: 

#### diff plot
```shell
nohup \
python frequency_analysis.py --transform $transform --img_root $img_root_dir \
--img_dirs $score_img_dirs \
--output_root $out_dir_root  \
--num_samples_per_imgdir $n_samples \
--log  \
--experiment $exp_id \
--num_workers 1 --diff \
--overwrite  &
```
- started: 20230327-015116
- pid: 2902